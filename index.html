<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Android Compass</title>
</head>
<body>
  <h1>Compass</h1>
  <p id="angle">Waiting for heading...</p>
  <button id="startButton">Start Compass</button>

  <script>
    const angleDisplay = document.getElementById("angle");

    function handleOrientationEvent(e) {
      let heading;
      if (e.webkitCompassHeading !== undefined) {
        heading = e.webkitCompassHeading;
      } else if (e.alpha !== null) {
        heading = 360 - e.alpha;
      }

      if (heading !== null) {
        heading = Math.round(heading);
        angleDisplay.textContent = `Heading: ${heading}Â°`;
      } else {
        angleDisplay.textContent = "No compass data.";
      }
    }

    function startCompass() {
      if (
        typeof DeviceOrientationEvent !== "undefined" &&
        typeof DeviceOrientationEvent.requestPermission === "function"
      ) {
        DeviceOrientationEvent.requestPermission().then(response => {
          if (response === "granted") {
            addListeners();
          } else {
            angleDisplay.textContent = "Permission denied.";
          }
        }).catch(console.error);
      } else {
        addListeners();
      }
    }

    function addListeners() {
      window.addEventListener("deviceorientationabsolute", handleOrientationEvent, true);
    }

    document.getElementById("startButton").addEventListener("click", startCompass);
  </script>
</body>
</html>
